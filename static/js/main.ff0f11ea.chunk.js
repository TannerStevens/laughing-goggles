(this.webpackJsonpblish=this.webpackJsonpblish||[]).push([[0],{264:function(e,t,a){e.exports=a(530)},350:function(e,t,a){},530:function(e,t,a){"use strict";a.r(t);var n=a(11),r=a(1),c=a.n(r),i=a(12),o=a.n(i),u=a(215),l=a.n(u),s=c.a.createContext(),d=(a(350),a(15)),m=a(223),f=a(43),h=a(144),p=a(54),v=a.n(p),b=a(567),E=a(571),g=a(140),j={prefixUrl:"https://api.guildwars2.com/"};function O(e,t){var a={};return Object.assign(a,j,{hooks:{beforeRequest:[function(e){var a=new URL(e.url),n=new URLSearchParams(a.searchParams.toString());return n.set("access_token",t),a.search=n,new Request(a,e)}]}}),g.a.get("v2/account",a).json().then((function(n){e({type:"mergeState",value:{api:g.a.create(a),token:t,id:n.id,name:n.name}}),localStorage.setItem("token",t)}))}function w(e){var t=Object(r.useContext)(s),a=Object(r.useState)(t.state.token||""),i=Object(n.a)(a,2),o=i[0],u=i[1],l=(Object(r.useRef)(null),Object(r.useRef)(null));return c.a.createElement("form",{autoComplete:"off",ref:l},c.a.createElement(E.a,{label:"API Key",value:o,inputProps:{required:!0},onChange:function(e){return u(e.target.value)}}),c.a.createElement(b.a,{onClick:function(){Array.prototype.reduce.call(l.current,(function(e,t){return t.validity.valid&&e}),!0)&&O(t.dispatch,o).catch((function(e){u("")}))}},"Set"))}var y={1:function(e){return e>1e4?[[Math.floor(e/1e4),"https://render.guildwars2.com/file/090A980A96D39FD36FBB004903644C6DBEFB1FFB/156904.png"],[Math.floor(e/100%100),"https://render.guildwars2.com/file/E5A2197D78ECE4AE0349C8B3710D033D22DB0DA6/156907.png"],[e%100,"https://render.guildwars2.com/file/6CF8F96A3299CFC75D5CC90617C3C70331A1EF0E/156902.png"]]:e>100?[[Math.floor(e/100%100),"https://render.guildwars2.com/file/E5A2197D78ECE4AE0349C8B3710D033D22DB0DA6/156907.png"],[e%100,"https://render.guildwars2.com/file/6CF8F96A3299CFC75D5CC90617C3C70331A1EF0E/156902.png"]]:[[e,"https://render.guildwars2.com/file/6CF8F96A3299CFC75D5CC90617C3C70331A1EF0E/156902.png"]]}};function D(e){var t=Object(r.useContext)(s),a=Object(r.useState)([]),i=Object(n.a)(a,2),o=i[0],u=i[1];return Object(r.useEffect)((function(){var a,n;(a=e.currency,n=t.state.api,y.hasOwnProperty(a.id)?Promise.all(y[a.id](a.value)):Promise.all([Promise.all([a.value,n.get("v2/currencies?ids=".concat(a.id)).json().then((function(e){return e.icon}))])])).then(u)}),[e.currency]),c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},o.length?o.map((function(e,t){var a=Object(n.a)(e,2),r=a[0],i=a[1];return c.a.createElement(c.a.Fragment,null,c.a.createElement("p",null,r),c.a.createElement("img",{src:i,style:{width:"1.5rem",height:"1.5rem"}}))})):null)}var C=a(574),x=a(570),S=a(572),A=a(20),k=a.n(A),F=a(19),P=a(22),B=a(36),I=a(568),R=a(569);function _(e){var t,a,n;return e.data?(null===(t=e.data)||void 0===t||null===(a=t.slotData)||void 0===a||null===(n=a.upgrades)||void 0===n?void 0:n.length)?c.a.createElement(I.a,{container:!0,direction:"column"},c.a.createElement(I.a,{item:!0,xs:12,container:!0,direction:"row",justify:"space-between",alignItems:"stretch"},c.a.createElement(I.a,{item:!0,xs:1},c.a.createElement("img",{style:{height:"56px",width:"56px"},src:e.data.itemData.icon})),c.a.createElement(I.a,{item:!0,xs:3},c.a.createElement(R.a,null,e.data.itemData.name)),c.a.createElement(I.a,{item:!0,xs:3},e.data.valueData?c.a.createElement(D,{currency:{id:1,value:e.data.valueData.buys.unit_price}}):null),c.a.createElement(I.a,{item:!0,xs:2},c.a.createElement(R.a,null,e.data.count)),c.a.createElement(I.a,{item:!0,xs:3},e.data.valueData?c.a.createElement(D,{currency:{id:1,value:e.data.valueData.buys.unit_price*e.data.count}}):null)),e.data.slotData.upgrades.map((function(e,t){return c.a.createElement(I.a,{item:!0,xs:12,container:!0,direction:"row"},c.a.createElement(I.a,{item:!0,xs:1}),c.a.createElement(I.a,{item:!0,xs:11},c.a.createElement(_,{key:t,data:e})))}))):c.a.createElement(I.a,{container:!0,direction:"row",justify:"space-between",alignItems:"stretch"},c.a.createElement(I.a,{item:!0,xs:1},c.a.createElement("img",{style:{height:"56px",width:"56px"},src:e.data.itemData.icon})),c.a.createElement(I.a,{item:!0,xs:3},c.a.createElement(R.a,null,e.data.itemData.name)),c.a.createElement(I.a,{item:!0,xs:3},e.data.valueData?c.a.createElement(D,{currency:{id:1,value:e.data.valueData.buys.unit_price}}):null),c.a.createElement(I.a,{item:!0,xs:2},c.a.createElement(R.a,null,e.data.count)),c.a.createElement(I.a,{item:!0,xs:3},e.data.valueData?c.a.createElement(D,{currency:{id:1,value:e.data.valueData.buys.unit_price*e.data.count}}):null)):null}var q=v.a.duration(10,"minutes"),J={};function M(e,t){return U.apply(this,arguments)}function U(){return(U=Object(B.a)(k.a.mark((function e(t,a){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=a.reduce((function(e,t){return J.hasOwnProperty(t)&&(null==J[t].value||v()()-J[t].value.fetchedAt<q)?e:[].concat(Object(d.a)(e),[t])}),[])).length){e.next=4;break}return e.next=4,t.get("v2/commerce/prices?ids=".concat(n.join(","))).json().then((function(e){var t=v()();e.forEach((function(e){return J[e.id]=Object.assign(J[e.id]||{},{value:e,fetchedAt:t})}))}));case 4:return a.forEach((function(e){J.hasOwnProperty(e)||(J.value=null)})),e.abrupt("return",a.reduce((function(e,t){var a,n=null===(a=J[t])||void 0===a?void 0:a.value;return n?[].concat(Object(d.a)(e),[n]):e}),[]));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t){return $.apply(this,arguments)}function $(){return($=Object(B.a)(k.a.mark((function e(t,a){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=a.reduce((function(e,t){return J.hasOwnProperty(t)&&void 0!=J[t].item?e:[].concat(Object(d.a)(e),[t])}),[])).length){e.next=4;break}return e.next=4,t.get("v2/items?ids=".concat(n.join(","))).json().then((function(e){e.forEach((function(e){return J[e.id]=Object.assign(J[e.id]||{},{item:e})}))}));case 4:return a.forEach((function(e){J.hasOwnProperty(e)||(J.item=null)})),e.abrupt("return",a.reduce((function(e,t){var a,n=null===(a=J[t])||void 0===a?void 0:a.item;return n?[].concat(Object(d.a)(e),[n]):e}),[]));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e){var t=Object(r.useContext)(s),a=Object(r.useState)([]),i=Object(n.a)(a,2),o=i[0],u=i[1];return Object(r.useEffect)((function(){if(e.slots&&0!=e.slots.length){var a=[],r=e.slots.reduce((function(e,t){return t&&(e.hasOwnProperty(t.id)?e[t.id].count+=t.count:(e[t.id]={id:t.id,count:t.count,slotData:t},t.upgrades?a.push.apply(a,[t.id].concat(Object(d.a)(t.upgrades))):a.push(t.id))),e}),{});Promise.all([W(t.state.api,a),M(t.state.api,a)]).then((function(e){var t=Object(n.a)(e,2),c=t[0],i=t[1];c=c.reduce((function(e,t){return Object(P.a)(Object(P.a)({},e),{},Object(F.a)({},t.id,t))}),{}),i=i.reduce((function(e,t){return Object(P.a)(Object(P.a)({},e),{},Object(F.a)({},t.id,t))}),{}),console.log(c,i,a),Object.values(r).forEach((function(e){var t=0;c.hasOwnProperty(e.id)&&(e.itemData=c[e.id]),i.hasOwnProperty(e.id)&&(e.valueData=i[e.id],t=e.valueData.buys.unit_price*e.count),e.slotData.upgrades&&(e.slotData.upgrades=e.slotData.upgrades.map((function(e){var a=i[e];return a&&(t+=a.buys.unit_price),{id:e,count:1,itemData:c[e],valueData:a}}))),e.worth=t})),u(Object.values(r))}))}else u([])}),[e.slots]),console.log(o),o.filter((function(e){return e&&e.itemData})).sort((function(e,t){return t.worth-e.worth})).map((function(e,t){return c.a.createElement(_,{key:t,data:e})}))}function L(e){var t=Object(r.useContext)(s),a=Object(r.useState)(""),i=Object(n.a)(a,2),o=i[0],u=i[1],l=Object(r.useState)([]),m=Object(n.a)(l,2),f=m[0],h=m[1],p=Object(r.useState)([]),v=Object(n.a)(p,2),E=v[0],g=v[1],j=Object(r.useState)(!1),O=Object(n.a)(j,2),w=O[0],y=O[1];return Object(r.useEffect)((function(){t.state.api.get("v2/characters").json().then(h)}),[t.id]),Object(r.useEffect)((function(){o?t.state.api.get("v2/characters/".concat(encodeURI(o),"/inventory")).json().then((function(e){var t=e.bags;return g(t.reduce((function(e,t){return[].concat(Object(d.a)(e),Object(d.a)(t.inventory))}),[]))})):g([]),y(!1)}),[o,t.id,w]),c.a.createElement("div",null,c.a.createElement("div",null,c.a.createElement(C.a,null,"Character"),c.a.createElement(x.a,{value:o,onChange:function(e){return u(e.target.value)}},f.map((function(e){return c.a.createElement(S.a,{key:e,value:e},e)}))),c.a.createElement(b.a,{onClick:function(){return y(!0)}},"Refresh")),c.a.createElement(K,{slots:E}))}var N=function(){var e=Object(r.useContext)(s),t=Object(r.useState)({timestamp:{$gte:v()().startOf("day").toDate(),$lt:v()().endOf("day").toDate()}}),a=Object(n.a)(t,2),i=a[0],o=(a[1],function(e){var t=Object(r.useRef)();return Object(r.useEffect)((function(){t.current=e})),t.current}(i)),u=Object(r.useState)([]),l=Object(n.a)(u,2),p=l[0],b=l[1];return Object(r.useEffect)((function(){if(o!==i)e.state.db.collection("wealth").find(i).toArray().then((function(e){b(e)}));else{var t=[].concat(Object(d.a)(p),[{account_id:e.state.id,timestamp:new Date,data:e.state.wealth}]);console.log(t),b(t)}}),[i,e.state.wealth]),c.a.createElement(m.a,null,c.a.createElement(f.c,null,e.state.id&&c.a.createElement(f.a,{path:"/"},c.a.createElement("h1",null,"Hello World",c.a.createElement("img",{src:"https://static.staticwars.com/quaggans/construction.jpg",style:{height:"3rem",width:"3rem"}})),e.state.wealth&&c.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},c.a.createElement(D,{currency:e.state.wealth[0],api:e.state.api}),c.a.createElement(h.b,{width:100,height:50,data:p},c.a.createElement(h.a,{type:"monotone",dataKey:function(e){return e.data[0].value},stroke:"#FFA71A",dot:!1}))),c.a.createElement(L,null)),c.a.createElement(f.a,{path:"/"},c.a.createElement(w,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var H={db:new l.a.Db("db",2,{wealth:["account_id","timestamp"]}),api:void 0,token:void 0,id:void 0,name:void 0};function z(e,t){switch(t.type){case"mergeState":return Object.assign({},e,t.value);default:return e}}function G(e){var t=Object(r.useReducer)(z,H),a=Object(n.a)(t,2),i=a[0],o=a[1],u=Object(r.useState)({state:i,dispatch:o}),l=Object(n.a)(u,2),d=l[0],m=l[1];function f(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Promise.all([i.db.collection("wealth").find().sort({timestamp:-1}).limit(1).toArray(),i.api.get("v2/account/wallet").json()]).then((function(t){var a=Object(n.a)(t,2),r=Object(n.a)(a[0],1)[0],c=a[1];if(r&&JSON.stringify(r.data)==JSON.stringify(c))e&&o({type:"mergeState",value:{wealth:c}});else{var u={account_id:i.id,timestamp:new Date,data:c};i.db.collection("wealth").insert(u),console.log(u),o({type:"mergeState",value:{wealth:c}})}}))}return Object(r.useEffect)((function(){i.db.collection("wealth").find().toArray().then(console.log);var e=window.localStorage.getItem("token");e&&O(o,e).catch((function(e){window.localStorage.removeItem("token")}))}),[]),Object(r.useEffect)((function(){console.log(i);var e={state:i,dispatch:o};m(e),window.providerState=e}),[i]),Object(r.useEffect)((function(){i.api&&(f(!0),setInterval(f,6e4))}),[i.api]),c.a.createElement(s.Provider,{value:d},c.a.createElement(N,null))}o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(G,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[264,1,2]]]);
//# sourceMappingURL=main.ff0f11ea.chunk.js.map