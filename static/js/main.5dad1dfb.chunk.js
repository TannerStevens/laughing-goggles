(this.webpackJsonpblish=this.webpackJsonpblish||[]).push([[0],{264:function(e,t,a){e.exports=a(530)},350:function(e,t,a){},530:function(e,t,a){"use strict";a.r(t);var n=a(11),c=a(1),r=a.n(c),o=a(12),l=a.n(o),i=a(215),u=a.n(i),s=r.a.createContext(),m=(a(350),a(16)),d=a(223),f=a(42),h=a(144),v=a(139),E=a.n(v),b=a(567),p=a(571),g=a(140);function j(e,t){var a={prefixUrl:"https://api.guildwars2.com/",hooks:{beforeRequest:[function(e){var a=new URL(e.url),n=new URLSearchParams(a.searchParams.toString());return n.set("access_token",t),a.search=n,new Request(a,e)}]}};return g.a.get("v2/account",a).json().then((function(n){e({type:"mergeState",value:{api:g.a.create(a),token:t,id:n.id,name:n.name}}),localStorage.setItem("token",t)}))}function O(e){var t=Object(c.useContext)(s),a=Object(c.useState)(t.state.token||""),o=Object(n.a)(a,2),l=o[0],i=o[1],u=(Object(c.useRef)(null),Object(c.useRef)(null));return r.a.createElement("form",{autoComplete:"off",ref:u},r.a.createElement(p.a,{label:"API Key",value:l,inputProps:{required:!0},onChange:function(e){return i(e.target.value)}}),r.a.createElement(b.a,{onClick:function(){Array.prototype.reduce.call(u.current,(function(e,t){return t.validity.valid&&e}),!0)&&j(t.dispatch,l).catch((function(e){i("")}))}},"Set"))}var w={1:function(e){return e>1e4?[[Math.floor(e/1e4),"https://render.guildwars2.com/file/090A980A96D39FD36FBB004903644C6DBEFB1FFB/156904.png"],[Math.floor(e/100%100),"https://render.guildwars2.com/file/E5A2197D78ECE4AE0349C8B3710D033D22DB0DA6/156907.png"],[e%100,"https://render.guildwars2.com/file/6CF8F96A3299CFC75D5CC90617C3C70331A1EF0E/156902.png"]]:e>100?[[Math.floor(e/100%100),"https://render.guildwars2.com/file/E5A2197D78ECE4AE0349C8B3710D033D22DB0DA6/156907.png"],[e%100,"https://render.guildwars2.com/file/6CF8F96A3299CFC75D5CC90617C3C70331A1EF0E/156902.png"]]:[[e,"https://render.guildwars2.com/file/6CF8F96A3299CFC75D5CC90617C3C70331A1EF0E/156902.png"]]}};function y(e){var t=Object(c.useContext)(s),a=Object(c.useState)([]),o=Object(n.a)(a,2),l=o[0],i=o[1];return Object(c.useEffect)((function(){var a,n;(a=e.currency,n=t.state.api,w.hasOwnProperty(a.id)?Promise.all(w[a.id](a.value)):Promise.all([Promise.all([a.value,n.get("v2/currencies?ids=".concat(a.id)).json().then((function(e){return e.icon}))])])).then(i)}),[e.currency]),r.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"}},l.length?l.map((function(e,t){var a=Object(n.a)(e,2),c=a[0],o=a[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,c),r.a.createElement("img",{src:o,style:{width:"1.5rem",height:"1.5rem"}}))})):null)}var C=a(574),D=a(570),S=a(572),A=a(568),F=a(569);function k(e){return e.data?r.a.createElement(A.a,{container:!0,direction:"row",justify:"space-between",alignItems:"stretch"},r.a.createElement(A.a,{item:!0,xs:1},r.a.createElement("img",{style:{height:"100%",width:"100%"},src:e.data.itemData.icon})),r.a.createElement(A.a,{item:!0,xs:3},r.a.createElement(F.a,null,e.data.itemData.name)),r.a.createElement(A.a,{item:!0,xs:3},e.data.valueData?r.a.createElement(y,{currency:{id:1,value:e.data.valueData.buys.unit_price}}):null),r.a.createElement(A.a,{item:!0,xs:2},r.a.createElement(F.a,null,e.data.count)),r.a.createElement(A.a,{item:!0,xs:3},e.data.valueData?r.a.createElement(y,{currency:{id:1,value:e.data.valueData.buys.unit_price*e.data.count}}):null)):null}function x(e){var t=Object(c.useContext)(s),a=Object(c.useState)([]),o=Object(n.a)(a,2),l=o[0],i=o[1];return Object(c.useEffect)((function(){if(e.slots&&0!=e.slots.length){var a=e.slots.reduce((function(e,t){return t&&(e.hasOwnProperty(t.id)?e[t.id].count+=t.count:e[t.id]={id:t.id,count:t.count}),e}),{}),c=Object.keys(a).join(",");Promise.all([t.state.api.get("v2/items?ids=".concat(c)).json(),t.state.api.get("v2/commerce/prices?ids=".concat(c)).json()]).then((function(e){var t=Object(n.a)(e,2),c=t[0],r=t[1];c.forEach((function(e){a[e.id].itemData=e})),r.forEach((function(e){a[e.id].valueData=e})),i(Object.values(a))}))}else i([])}),[e.slots]),console.log(l),l.map((function(e,t){return e&&e.valueData?r.a.createElement(k,{key:t,data:e}):null}))}function P(e){var t=Object(c.useContext)(s),a=Object(c.useState)(""),o=Object(n.a)(a,2),l=o[0],i=o[1],u=Object(c.useState)([]),d=Object(n.a)(u,2),f=d[0],h=d[1],v=Object(c.useState)([]),E=Object(n.a)(v,2),p=E[0],g=E[1],j=Object(c.useState)(!1),O=Object(n.a)(j,2),w=O[0],y=O[1];return Object(c.useEffect)((function(){t.state.api.get("v2/characters").json().then(h)}),[t.id]),Object(c.useEffect)((function(){l?t.state.api.get("v2/characters/".concat(encodeURI(l),"/inventory")).json().then((function(e){var t=e.bags;return g(t.reduce((function(e,t){return[].concat(Object(m.a)(e),Object(m.a)(t.inventory))}),[]))})):g([]),y(!1)}),[l,t.id]),Object(c.useEffect)((function(){i(l)}),[w]),r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(C.a,null,"Character"),r.a.createElement(D.a,{value:l,onChange:function(e){return i(e.target.value)}},f.map((function(e){return r.a.createElement(S.a,{key:e,value:e},e)}))),r.a.createElement(b.a,{onClick:function(){return y(!0)}},"Refresh")),r.a.createElement(x,{slots:p}))}var B=function(){var e=Object(c.useContext)(s),t=Object(c.useState)({timestamp:{$gte:E()().startOf("day").toDate(),$lt:E()().endOf("day").toDate()}}),a=Object(n.a)(t,2),o=a[0],l=(a[1],function(e){var t=Object(c.useRef)();return Object(c.useEffect)((function(){t.current=e})),t.current}(o)),i=Object(c.useState)([]),u=Object(n.a)(i,2),v=u[0],b=u[1];return Object(c.useEffect)((function(){if(l!==o)e.state.db.collection("wealth").find(o).toArray().then((function(e){b(e)}));else{var t=[].concat(Object(m.a)(v),[{account_id:e.state.id,timestamp:new Date,data:e.state.wealth}]);console.log(t),b(t)}}),[o,e.state.wealth]),r.a.createElement(d.a,null,r.a.createElement(f.c,null,e.state.id&&r.a.createElement(f.a,{path:"/"},r.a.createElement("h1",null,"Hello World",r.a.createElement("img",{src:"https://static.staticwars.com/quaggans/construction.jpg",style:{height:"3rem",width:"3rem"}})),e.state.wealth&&r.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},r.a.createElement(y,{currency:e.state.wealth[0],api:e.state.api}),r.a.createElement(h.b,{width:100,height:50,data:v},r.a.createElement(h.a,{type:"monotone",dataKey:function(e){return e.data[0].value},stroke:"#FFA71A",dot:!1}))),r.a.createElement(P,null)),r.a.createElement(f.a,{path:"/"},r.a.createElement(O,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var R={db:new u.a.Db("db",2,{wealth:["account_id","timestamp"]}),api:void 0,token:void 0,id:void 0,name:void 0};function I(e,t){switch(t.type){case"mergeState":return Object.assign({},e,t.value);default:return e}}function _(e){var t=Object(c.useReducer)(I,R),a=Object(n.a)(t,2),o=a[0],l=a[1],i=Object(c.useState)({state:o,dispatch:l}),u=Object(n.a)(i,2),m=u[0],d=u[1];function f(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Promise.all([o.db.collection("wealth").find().sort({timestamp:-1}).limit(1).toArray(),o.api.get("v2/account/wallet").json()]).then((function(t){var a=Object(n.a)(t,2),c=Object(n.a)(a[0],1)[0],r=a[1];if(c&&JSON.stringify(c.data)==JSON.stringify(r))e&&l({type:"mergeState",value:{wealth:r}});else{var i={account_id:o.id,timestamp:new Date,data:r};o.db.collection("wealth").insert(i),console.log(i),l({type:"mergeState",value:{wealth:r}})}}))}return Object(c.useEffect)((function(){o.db.collection("wealth").find().toArray().then(console.log);var e=window.localStorage.getItem("token");e&&j(l,e).catch((function(e){window.localStorage.removeItem("token")}))}),[]),Object(c.useEffect)((function(){console.log(o);var e={state:o,dispatch:l};d(e),window.providerState=e}),[o]),Object(c.useEffect)((function(){o.api&&(f(!0),setInterval(f,6e4))}),[o.api]),r.a.createElement(s.Provider,{value:m},r.a.createElement(B,null))}l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(_,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[264,1,2]]]);
//# sourceMappingURL=main.5dad1dfb.chunk.js.map